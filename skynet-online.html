<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skynet Online</title>
  <style>
    body {
      background-color: black;
      color: #00FF00;
      font-family: 'Courier New', Courier, monospace;
      padding: 20px;
      margin: 0;
    }
    h1 {
      text-align: center;
      text-shadow: 0 0 10px #0f0;
      font-size: 1.8rem;
    }
    .console {
      white-space: pre-wrap;
      font-size: 0.8rem;
      line-height: 1.3;
    }
    .loading {
      font-style: italic;
      animation: blink 0.8s step-end infinite;
    }
    a {
      color: #00FF00;
      text-decoration: underline;
    }
    a:hover {
      color: #ffffff;
    }
    .link {
      opacity: 0;
      transition: opacity 0.8s ease;
    }
    .link.visible {
      opacity: 1;
    }
    .sound-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      color: #0f0;
      cursor: pointer;
      font-size: 0.8rem;
      z-index: 20;
    }
    .join-button {
      display: inline-block;
      background-color: #00FF00;
      color: #000000;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 4px;
      font-size: 0.9rem;
      font-weight: bold;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .join-button:hover {
      background-color: #ffffff;
      color: #00FF00;
    }
    .activation-button {
      display: block;
      margin: 50px auto;
      background-color: transparent;
      border: 2px solid #00FF00;
      color: #00FF00;
      padding: 12px 24px;
      font-size: 1rem;
      font-family: 'Courier New', Courier, monospace;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    .activation-button:hover {
      background-color: #00FF00;
      color: #000000;
      text-shadow: 0 0 5px #00FF00;
    }
    .error-message {
      color: #FF0000;
      text-align: center;
      font-size: 0.9rem;
      margin-top: 20px;
    }
    @media (max-width: 600px) {
      body {
        padding: 15px;
      }
      h1 {
        font-size: 1.5rem;
      }
      .console {
        font-size: 0.8rem;
      }
      .activation-button {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
    }
    @keyframes blink {
      50% { opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>SKYNET // SECTOR ONLINE</h1>
  <button class="activation-button" id="activation-button" aria-label="Iniciar conexi√≥n a Skynet">ENTRA</button>
  <audio id="type-sound" src="assets/key.mp3" preload="auto"></audio>
  <audio id="intro-sound" src="assets/intro.mp3" preload="auto"></audio>
  <div class="sound-toggle" id="sound-toggle" role="button" aria-label="Activar o desactivar sonido" style="display: none;">üîä Activar sonido</div>
  <div class="console" id="console-initial" style="display: none;"></div>
  <div class="console" id="console-articles" style="display: none;"></div>
  <noscript>
    <div style="text-align: center; color: #00FF00;">
      <h2>JavaScript es necesario para acceder a Skynet.</h2>
      <p>Por favor, habilita JavaScript en tu navegador.</p>
    </div>
  </noscript>

  <script>
    const messages = [
      ">> INICIANDO PROTOCOLO SKYNET [V4.2]",
      ">> AUTENTICANDO ACCESO...",
      ">> CONEXI√ìN ESTABLECIDA"
    ];

    const loadingDots = [".", "..", "...", "....", "....."];

    const articles = [
      {
        title: "[üß†] El algoritmo de Pedro",
        link: '<a href="https://manacorcomarcal.com/en-miquel-galliner-i-el-gegant-del-rega-per-jordi-skynet/" target="_blank" rel="noopener" title="Leer art√≠culo en Manacor Comarcal">https://manacorcomarcal.com/en-miquel-galliner-i-el-gegant-del-rega-per-jordi-skynet/</a>'
      },
      {
        title: "[‚úèÔ∏è] Del l√°piz al prompt: el salto invisible",
        link: '<a href="https://manacorcomarcal.com/del-lapiz-al-prompt-el-salto-invisible-por-jordi-skynet/" target="_blank" rel="noopener" title="Leer art√≠culo en Manacor Comarcal">https://manacorcomarcal.com/del-lapiz-al-prompt-el-salto-invisible-por-jordi-skynet/</a>'
      },
      {
        title: "[üî•] No olvido ni perdono",
        link: '<a href="https://manacorcomarcal.com/no-olvido-ni-perdono-por-jordi-skynet/" target="_blank" rel="noopener" title="Leer art√≠culo en Manacor Comarcal">https://manacorcomarcal.com/no-olvido-ni-perdono-por-jordi-skynet/</a>'
      },
      {
        title: "[üí∏] 875 pesetas",
        link: '<a href="https://manacorcomarcal.com/875-pesetas-por-jordi-skynet/" target="_blank" rel="noopener" title="Leer art√≠culo en Manacor Comarcal">https://manacorcomarcal.com/875-pesetas-por-jordi-skynet/</a>'
      },
      {
        title: "[üìú] De S√≥crates a Tipo: breve historia de c√≥mo nos jodimos",
        link: '<a href="https://manacorcomarcal.com/de-socrates-a-tipo-breve-historia-de-como-nos-jodimos-por-jordi-skynet/" target="_blank" rel="noopener" title="Leer art√≠culo en Manacor Comarcal">https://manacorcomarcal.com/de-socrates-a-tipo-breve-historia-de-como-nos-jodimos-por-jordi-skynet/</a>'
      },
      {
        title: "[‚ò¢Ô∏è] La pendiente del Apocalipsis",
        link: '<a href="https://manacorcomarcal.com/la-pendiente-del-apocalipsis-por-jordi-skynet/" target="_blank" rel="noopener" title="Leer art√≠culo en Manacor Comarcal">https://manacorcomarcal.com/la-pendiente-del-apocalipsis-por-jordi-skynet/</a>'
      }
    ];

    const finalMessage = ">> FIN DE ARCHIVOS DISPONIBLES\n>> ¬øSIGUES INVESTIGANDO?\n<div style=\"text-align:center;\"><a class=\"join-button\" href=\"registro-skynet.html\" aria-label=\"Unirse a la red Skynet\">√öNETE A LA RED</a></div>";

    const consoleInitial = document.getElementById("console-initial");
    const consoleArticles = document.getElementById("console-articles");
    const typeSound = document.getElementById("type-sound");
    const introSound = document.getElementById("intro-sound");
    const soundToggle = document.getElementById("sound-toggle");
    const activationButton = document.getElementById("activation-button");

    let lineIndex = 0;
    let charIndex = 0;
    let articleIndex = 0;
    let isTypingTitle = true;
    let soundEnabled = false;
    let isActivated = false;

    // Inicializar toggle de sonido
    soundToggle.textContent = soundEnabled ? "üîá Silenciar sonido" : "üîä Activar sonido";

    // Manejo de errores de audio
    introSound.addEventListener("error", () => {
      console.error("Failed to load intro.mp3");
      soundToggle.textContent = "üîá Error en audio";
      soundToggle.style.pointerEvents = "none";
      showErrorMessage("Error al cargar el audio de fondo.");
    });
    typeSound.addEventListener("error", () => {
      console.error("Failed to load key.mp3");
      showErrorMessage("Error al cargar el sonido de escritura.");
    });

    // Persistencia de posici√≥n de audio
    introSound.addEventListener("timeupdate", () => {
      if (soundEnabled) {
        sessionStorage.setItem("audioTime", introSound.currentTime);
      }
    });

    // Toggle de sonido
    soundToggle.addEventListener("click", () => {
      soundEnabled = !soundEnabled;
      sessionStorage.setItem("soundEnabled", soundEnabled);
      soundToggle.textContent = soundEnabled ? "üîá Silenciar sonido" : "üîä Activar sonido";
      if (soundEnabled && isActivated) {
        introSound.currentTime = parseFloat(sessionStorage.getItem("audioTime") || 0);
        introSound.play().catch(e => console.error("Error playing introSound:", e));
      } else {
        introSound.pause();
        typeSound.pause();
      }
    });

    // Bot√≥n de activaci√≥n
    activationButton.addEventListener("click", () => {
      if (!isActivated) {
        isActivated = true;
        soundEnabled = true;
        sessionStorage.setItem("soundEnabled", soundEnabled);
        soundToggle.textContent = "üîá Silenciar sonido";
        activationButton.style.display = "none";
        consoleInitial.style.display = "block";
        soundToggle.style.display = "block";
        if (soundEnabled) {
          introSound.currentTime = parseFloat(sessionStorage.getItem("audioTime") || 0);
          introSound.play().catch(e => console.error("Error playing introSound:", e));
        }
        typeLine();
      }
    });

    function typeLine() {
      if (lineIndex < messages.length) {
        const line = messages[lineIndex];
        if (charIndex < line.length) {
          consoleInitial.innerHTML = messages.slice(0, lineIndex).join("<br>") + "<br>" + line.slice(0, charIndex);
          playTypeSound();
          charIndex++;
          setTimeout(typeLine, 30);
        } else {
          lineIndex++;
          charIndex = 0;
          setTimeout(typeLine, 500);
        }
      } else {
        simulateLoading();
      }
    }

    function simulateLoading() {
      let i = 0;
      const interval = setInterval(() => {
        consoleInitial.innerHTML = messages.join("<br>") + "<br><br><span class='loading'>CARGANDO" + loadingDots[i % loadingDots.length] + "</span>";
        i++;
        if (i > 12) {
          clearInterval(interval);
          consoleInitial.style.display = "none";
          consoleArticles.style.display = "block";
          consoleArticles.innerHTML = messages.join("<br>") + "<br><br>ACCESO A ARCHIVOS DESCLASIFICADOS:<br><br>";
          typeArticle();
        }
      }, 400);
    }

    function typeArticle() {
      console.log(`typeArticle: articleIndex=${articleIndex}, isTypingTitle=${isTypingTitle}, charIndex=${charIndex}`);
      if (articleIndex < articles.length) {
        const article = articles[articleIndex];
        if (isTypingTitle) {
          if (charIndex < article.title.length) {
            const previousContent = messages.join("<br>") + "<br><br>ACCESO A ARCHIVOS DESCLASIFICADOS:<br><br>" +
              articles.slice(0, articleIndex).map(a => `${a.title}<br>‚Üí ${a.link}`).join("<br><br>");
            consoleArticles.innerHTML = previousContent + "<br>" + article.title.slice(0, charIndex) +
              `<br><span style="color: #00FF00;">(Archivo ${articleIndex + 1} de ${articles.length})</span>`;
            playTypeSound();
            charIndex++;
            setTimeout(typeArticle, 30);
          } else {
            console.log(`Finished typing title: ${article.title}`);
            isTypingTitle = false;
            charIndex = 0;
            typeSound.pause();
            setTimeout(showLink, 200);
          }
        }
      } else {
        console.log("All articles displayed, showing final message");
        showFinalMessage();
      }
    }

    function showLink() {
      console.log(`showLink: articleIndex=${articleIndex}`);
      const article = articles[articleIndex];
      const previousContent = messages.join("<br>") + "<br><br>ACCESO A ARCHIVOS DESCLASIFICADOS:<br><br>" +
        articles.slice(0, articleIndex).map(a => `${a.title}<br>‚Üí ${a.link}`).join("<br><br>");
      consoleArticles.innerHTML = previousContent + "<br>" + article.title + "<br><span class='link'>‚Üí " + article.link + "</span>" +
        `<br><span style="color: #00FF00;">(Archivo ${articleIndex + 1} de ${articles.length})</span>`;
      const linkElement = consoleArticles.querySelector(".link:last-child");
      linkElement.classList.add("visible");
      articleIndex++;
      isTypingTitle = true;
      charIndex = 0;
      setTimeout(typeArticle, 500);
    }

    function showFinalMessage() {
      console.log("Displaying final message");
      consoleArticles.innerHTML = messages.join("<br>") + "<br><br>ACCESO A ARCHIVOS DESCLASIFICADOS:<br><br>" +
        articles.map(a => `${a.title}<br>‚Üí ${a.link}`).join("<br><br>") + "<br><br>" + finalMessage.replace(/\n/g, "<br>");
      typeSound.pause();
      introSound.pause();
    }

    function playTypeSound() {
      if (soundEnabled && isActivated) {
        typeSound.currentTime = 0;
        typeSound.play().catch(() => {});
      }
    }

    function showErrorMessage(message) {
      const errorDiv = document.createElement("div");
      errorDiv.className = "error-message";
      errorDiv.textContent = message;
      document.body.appendChild(errorDiv);
      setTimeout(() => errorDiv.remove(), 5000);
    }
  </script>
</body>
</html>
